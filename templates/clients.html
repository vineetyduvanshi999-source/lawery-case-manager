{% extends "base.html" %}
{% set active="clients" %}
{% set heading="Clients" %}
{% set subheading="Store client details separately." %}

{% block content %}

<div class="panel">

  <div style="display:flex; justify-content:space-between; align-items:flex-start; gap:14px; flex-wrap:wrap;">
    <div>
      <h2 style="font-size:18px; font-weight:900; color:#0b3a78;">ðŸ‘¤ Clients</h2>
      <p style="font-size:13px; color:#64748b; margin-top:4px;">
        Add, manage and delete client records.
      </p>
    </div>
  </div>

  <!-- ADD CLIENT FORM -->
  <div class="form-card" style="margin-top:14px; max-width:100%;">
    <h3 style="font-size:15px; font-weight:900; color:#0b3a78; margin-bottom:12px;">
      âž• Add New Client
    </h3>

    <form onsubmit="saveClient(event)">
      <div style="display:grid; grid-template-columns:1fr 1fr; gap:14px;">

        <div>
          <label>Client Name</label>
          <input type="text" id="name" placeholder="Enter client name" required>
        </div>

        <div>
          <label>Phone</label>
          <input type="text" id="phone" placeholder="Enter phone number">
        </div>

        <div>
          <label>Email</label>
          <input type="email" id="email" placeholder="Enter email address">
        </div>

        <div>
          <label>Address</label>
          <input type="text" id="address" placeholder="Enter address">
        </div>

      </div>

      <div style="margin-top:16px; display:flex; gap:12px; flex-wrap:wrap;">
        <button class="btn btn-primary" type="submit">ðŸ’¾ Save Client</button>
        <a href="/view" class="btn btn-light">ðŸ“‚ View Cases</a>
      </div>
    </form>
  </div>

  <!-- CLIENT TABLE -->
  <div style="margin-top:18px;">
    <h3 style="font-size:15px; font-weight:900; color:#0b3a78; margin-bottom:10px;">
      ðŸ“‹ Saved Clients
    </h3>

    <div class="table-wrap">
      <table class="table" style="min-width:950px;">
        <thead>
          <tr>
            <th>Name</th>
            <th>Phone</th>
            <th>Email</th>
            <th>Address</th>
            <th>Created</th>
            <th style="min-width:140px;">Action</th>
          </tr>
        </thead>

        <tbody id="clientTable">
          <tr>
            <td colspan="6" class="empty">Loading clients...</td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

</div>

<script>
async function loadClients(){
  let res = await fetch("/get_clients");
  let clients = await res.json();

  let table = document.getElementById("clientTable");
  table.innerHTML = "";

  if(clients.length === 0){
    table.innerHTML = `<tr><td colspan="6" class="empty">No clients added yet.</td></tr>`;
    return;
  }

  clients.forEach(c=>{
    table.innerHTML += `
      <tr>
        <td>${c.name || ""}</td>
        <td>${c.phone || ""}</td>
        <td>${c.email || ""}</td>
        <td>${c.address || ""}</td>
        <td>${c.created_at || ""}</td>
        <td>
          <button class="btn btn-danger" onclick="deleteClient(${c.id})">ðŸ—‘ Delete</button>
        </td>
      </tr>
    `;
  });
}

async function saveClient(e){
  e.preventDefault();

  let name = document.getElementById("name").value.trim();
  let phone = document.getElementById("phone").value.trim();
  let email = document.getElementById("email").value.trim();
  let address = document.getElementById("address").value.trim();

  if(name === ""){
    alert("Client name is required!");
    return;
  }

  let res = await fetch("/add_client", {
    method: "POST",
    headers: { "Content-Type": "application/json" },
    body: JSON.stringify({ name, phone, email, address })
  });

  let data = await res.json();
  alert(data.message || "Client saved!");

  document.getElementById("name").value = "";
  document.getElementById("phone").value = "";
  document.getElementById("email").value = "";
  document.getElementById("address").value = "";

  loadClients();
}

async function deleteClient(id){
  if(!confirm("Are you sure you want to delete this client?")) return;

  let res = await fetch("/delete_client/" + id, {
    method: "DELETE"
  });

  let data = await res.json();
  alert(data.message || "Client deleted!");

  loadClients();
}

loadClients();
</script>

{% endblock %}
